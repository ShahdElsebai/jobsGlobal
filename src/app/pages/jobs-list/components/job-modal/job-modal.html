@if (isOpen()) {
  <div
    class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    role="dialog"
    aria-modal="true"
    (click)="close()"
    tabindex="0"
    (keydown.enter)="close()"
    (keydown.space)="close()">
    <div
      #dialogRef
      class="relative w-full max-w-xl bg-white rounded-xl shadow-2xl ring-1 ring-black/10 p-6 focus:outline-none transition-transform duration-200 ease-out"
      (click)="$event.stopPropagation()"
      tabindex="0"
      role="document"
      (keydown)="$event.stopPropagation()">
      <button
        aria-label="Close modal"
        class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded"
        (click)="close()">
        âœ•
      </button>

      @if (!showApplicationForm()) {
        <h2 class="text-2xl font-bold mb-4">{{ job()?.title }}</h2>
        <p class="mb-2 font-semibold">{{ job()?.page?.name }}</p>
        <p class="text-gray-600 mb-4">
          {{ job()?.location?.city?.name }},
          {{ job()?.location?.country?.name }}
        </p>
        <p class="mb-6 text-gray-700">{{ job()?.description }}</p>

        <div class="flex gap-4">
          <button
            class="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:bg-gray-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
            (click)="applyClicked()"
            [disabled]="applied()">
            @if (applied()) {
              <span>Already Applied</span>
            } @else {
              <span>Apply</span>
            }
          </button>

          <button
            class="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
            (click)="saveClicked()"
            [disabled]="isSaved()">
            @if (isSaved()) {
              <span>Already Saved</span>
            } @else {
              <span>Save Job</span>
            }
          </button>
        </div>
      } @else {
        <app-application-form
          [job]="job()"
          (submitSuccess)="onSubmitSuccess()"
          (cancelForm)="cancelApplication()"></app-application-form>
      }
    </div>
  </div>
}
