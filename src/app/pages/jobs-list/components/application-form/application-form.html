<form
  [formGroup]="form"
  (submit)="onSubmit()"
  novalidate
  class="w-full max-w-2xl mx-auto space-y-6">
  <!-- Fields grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Name -->
    <div>
      <label for="name" class="block mb-1 text-sm font-medium text-gray-800">
        Name
      </label>
      <input
        id="name"
        type="text"
        formControlName="name"
        autocomplete="name"
        [attr.aria-invalid]="isControlInvalid('name')"
        [attr.aria-describedby]="isControlInvalid('name') ? 'name-error' : null"
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('name')" />
      @if (isControlInvalid('name')) {
        <div
          id="name-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Name is required.
        </div>
      }
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block mb-1 text-sm font-medium text-gray-800">
        Email
      </label>
      <input
        id="email"
        type="email"
        formControlName="email"
        autocomplete="email"
        [attr.aria-invalid]="isControlInvalid('email')"
        [attr.aria-describedby]="
          isControlInvalid('email') ? 'email-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('email')" />
      @if (isControlInvalid('email')) {
        <div
          id="email-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Enter a valid email.
        </div>
      }
    </div>

    <!-- Phone -->
    <div>
      <label for="phone" class="block mb-1 text-sm font-medium text-gray-800">
        Phone
      </label>
      <input
        id="phone"
        type="text"
        formControlName="phone"
        autocomplete="tel"
        [attr.aria-invalid]="isControlInvalid('phone')"
        [attr.aria-describedby]="
          isControlInvalid('phone') ? 'phone-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('phone')" />
      @if (isControlInvalid('phone')) {
        <div
          id="phone-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          @if (form.controls.phone.errors?.['required']) {
            Phone is required.
          } @else if (form.controls.phone.errors?.['pattern']) {
            Enter a valid phone number (digits, space, +, -, (), 7â€“20 chars).
          }
        </div>
      }
    </div>

    <!-- Country -->
    <div>
      <label for="country" class="block mb-1 text-sm font-medium text-gray-800">
        Country
      </label>
      <input
        id="country"
        type="text"
        formControlName="country"
        autocomplete="country-name"
        [attr.aria-invalid]="isControlInvalid('country')"
        [attr.aria-describedby]="
          isControlInvalid('country') ? 'country-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('country')" />
      @if (isControlInvalid('country')) {
        <div
          id="country-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Country is required.
        </div>
      }
    </div>

    <!-- Education -->
    <div>
      <label
        for="education"
        class="block mb-1 text-sm font-medium text-gray-800">
        Education
      </label>
      <input
        id="education"
        type="text"
        formControlName="education"
        [attr.aria-invalid]="isControlInvalid('education')"
        [attr.aria-describedby]="
          isControlInvalid('education') ? 'education-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('education')" />
      @if (isControlInvalid('education')) {
        <div
          id="education-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Education is required.
        </div>
      }
    </div>

    <!-- Position -->
    <div>
      <label
        for="position"
        class="block mb-1 text-sm font-medium text-gray-800">
        Current Position
      </label>
      <input
        id="position"
        type="text"
        formControlName="position"
        [attr.aria-invalid]="isControlInvalid('position')"
        [attr.aria-describedby]="
          isControlInvalid('position') ? 'position-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('position')" />
      @if (isControlInvalid('position')) {
        <div
          id="position-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Current position is required.
        </div>
      }
    </div>

    <!-- Company -->
    <div class="md:col-span-2">
      <label for="company" class="block mb-1 text-sm font-medium text-gray-800">
        Company
      </label>
      <input
        id="company"
        type="text"
        formControlName="company"
        [attr.aria-invalid]="isControlInvalid('company')"
        [attr.aria-describedby]="
          isControlInvalid('company') ? 'company-error' : null
        "
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition disabled:bg-gray-100"
        [class.border-red-500]="isControlInvalid('company')" />
      @if (isControlInvalid('company')) {
        <div
          id="company-error"
          class="text-red-600 text-xs mt-1"
          aria-live="polite">
          Company is required.
        </div>
      }
    </div>

    <!-- CV Upload -->
    <div class="md:col-span-2">
      <label
        class="block mb-1 text-sm font-medium text-gray-800"
        for="cvUpload">
        CV Upload (Max 3MB)
      </label>

      <div class="flex items-center gap-3">
        <input
          id="cvUpload"
          type="file"
          class="sr-only"
          (change)="onFileSelected($event)"
          accept=".pdf,.doc,.docx,.rtf" />
        <label
          for="cvUpload"
          class="inline-flex items-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm bg-white hover:bg-gray-50 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">
          <svg
            class="h-4 w-4"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true">
            <path
              d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V8.414A2 2 0 0013.586 7L9 2.414A2 2 0 007.586 2H4z" />
            <path d="M9 2.414V6a2 2 0 002 2h3.586L9 2.414z" />
          </svg>

          Choose file
        </label>
        <span class="text-sm text-gray-600 truncate">
          {{ selectedFile?.name || 'No file chosen' }}
        </span>
      </div>

      @if (fileError()) {
        <p class="text-red-600 text-xs mt-1" aria-live="polite">
          {{ fileError() }}
        </p>
      }
      <p class="text-xs text-gray-500 mt-1">
        Accepted: PDF, DOC, DOCX (max 3MB)
      </p>
    </div>

    <!-- Cover Letter -->
    <div class="md:col-span-2">
      <label
        for="coverLetter"
        class="block mb-1 text-sm font-medium text-gray-800">
        Cover Letter
      </label>
      <textarea
        id="coverLetter"
        formControlName="coverLetter"
        rows="4"
        class="block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-y"></textarea>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex flex-col-reverse gap-3 sm:flex-row sm:justify-end">
    <button
      type="button"
      class="inline-flex justify-center items-center rounded-lg border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
      (click)="cancelForm.emit()"
      [disabled]="submitting()">
      Cancel
    </button>

    <button
      type="submit"
      class="inline-flex justify-center items-center gap-2 rounded-lg bg-blue-600 text-white px-4 py-2 text-sm hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed"
      [disabled]="submitting()">
      @if (submitting()) {
        <svg
          class="h-4 w-4 animate-spin"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true">
          <circle
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
            opacity=".25" />
          <path
            d="M22 12a10 10 0 00-10-10"
            stroke="currentColor"
            stroke-width="4"
            stroke-linecap="round" />
        </svg>
        <span>Submitting...</span>
      } @else {
        <span>Submit Application</span>
      }
    </button>
  </div>
</form>
